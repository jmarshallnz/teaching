---
title: "227.215 Biostats Lab 3"
output:
  pdf_document: null
  html_document: default
graphics: yes
---

## Introduction

In this lab we'll look at a set of data on the birth weight of lambs, based on the data from a previous year's project, taken from a trial at Massey in the late 1990s. This will therefore be good practice for your project this year!

Mixed-aged, Border Leicester x Romney ($n=160$) ewes were randomly allocated after preganancy diagnosis to a factorial experiment involving two shearing treatments (shorn on day 70 vs not); two pregnancy ranks (single or twin); and four feeding regimes (HH, HM, MH, MM), where the first letter refers to feed during days 70-101 of pregancy, and the second during days 102-140.  The M (maintenance) feeding group were fed at a level calculated to maintain maternal conceptus-free weight, while the H (high) feeding group were fed to gain around 100g per day above this during the relevant period.

Of particular interest is how feed management and shearing during pregnancy influence lamb birth weight.  The data set consists of the following variables from 204 lambs.

Variable      Description
--------      -----------
`DamID`       Identifying number for the ewe.
`LambID`      Identifying number for the lamb.
`DateBirth`   Date of birth of the lamb.
`Rank`        Whether the lamb was Single or a Twin.
`Sex`         The sex of the lamb (Male, Female).
`BirthWeight` The weight of the lamb at birth (in kg).
`Feed`        The feed regime of the ewe (HH, HM, MH, HH).
`Shorn`       Whether the ewe was shorn during pregnancy (Yes, No).

Start by downloading the `lab3_lambs.Rmd` document from Stream and loading it into RStudio. Then run the first code block that is loading the libraries we'll need (`ggplot2` and `visreg`) and reading the data in.

    ```{r, eval=FALSE}
    #' Read in the lamb birthweight data
    births <- read.csv("http://www.massey.ac.nz/~jcmarsha/227215/data/birthweight.csv")
    head(births)
    ```

## Exercise 2: Exploratory analysis of birthweight data

1. Add some code and comments to your R script to produce some plots of `BirthWeight` versus the covariates `Rank`, `Sex`, `Feed` and `Shorn`.

2. Why do you think you can't see much difference between the `Feed` treatment groups in these data?

3. To try and better see what is going on, we could look at subsetting the data
by the variables we know will make a difference. e.g. we could do

    ```{r, eval=FALSE}
    plot(BirthWeight ~ Feed, data=subset(births, Rank == 'Twin'))
    plot(BirthWeight ~ Feed, data=subset(births, Rank == 'Single'))
    ```

4. Try doing plots for male and female as well.

5. An even better way to do this is to utilise the `ggplot2` library to produce "small multiples" which share a common scale. It works a little different to the standard plotting, in that the first two parameters are `x` and `y` rather than using a formula `y ~ x`. e.g. try:
    ```{r, eval=FALSE}
    library(ggplot2)
    qplot(Feed, BirthWeight, data=births)
    ```
    You should get scatterplots. This is because the default 'geometry' to use is points. You can change this by adding `geom='boxplot'` to the `qplot` command to get boxplots. Other options are `geom='line'` for line plots and there are many more.

6. The `ggplot2` library then allows us to split the data over multiple plots by 'adding on' the `facet_wrap` or `facet_grid` commands. Try:
    ```{r, eval=FALSE}
    qplot(Feed, BirthWeight, data=births, geom='boxplot') + facet_wrap(~Rank)
    ```
    Try also doing a plot of Birthweight versus feed for each sex.

7. The `facet_grid` option can then be used to split over two variables in a grid. e.g. try adding
    ```{r, eval=FALSE}
    facet_grid(Sex ~ Rank)
    ```
    in place of `facet_wrap` to put rows for each sex, and columns for each rank.

8. What is your conclusion about the effect of feed on birthweight?

## Exercise 3: Linear modelling of birthweight data

In this exercise we'll look at analysing the average birthweight with a linear model. **Remember to add comments to your R script so that when you compile the notebook you have some commentary to look back on later.**

1. Fit a linear model to the birthweight data using only the `Feed` variable. Use the `anova` and `summary` tables to make a conclusion as to whether the feed treatment matters according to this model. Does this make sense based on what we've seen in the plots we did earlier?

2. Fit a multivariable linear model using the four covariates `Sex`, `Rank`, `Feed` and `Shorn`. Use the `anova` and `summary` tables to make conclusions about the importance of each of these variables to birthweight. Note down whether these make sense given the plots we did earlier.

3. Produce predictions, with 95% intervals, for:
    a. The weight of a male twin, born to an unshorn ewe on the HM feeding treatment.
    b. The average weight of a female singles, born to an unshorn ewes on the MM feeding treatment.

4. Visualise your results using the `visreg` package.

## Exercise 4: Interactions and model diagnostics.

1. Add an interaction to your multivariable model to assess whether the effect of shearing might differ between twins and singles. What is your conclusion?

2. Visualise the effect of shearing on birthweight for twins and singles. You can do this via

    ```{r, eval=FALSE}
    visreg(model, "Shorn", by="Rank")
    ```

    You can optionally add `overlay=TRUE` to overlay the effects rather than using side by side, and `gg=TRUE` for using the ggplot2 library instead.
    
3. Check the model diagnostics for your model with the interaction. Are the model assumptions met?
