---
title: "227.215 Biostats Lab 2"
author: "Jonathan Marshall"
date: "15 July 2015"
output:
  pdf_document: null
  html_document: default
graphics: yes
---

## Introduction ##

In this lab we'll cover linear model diagnostics, transformations for linearity, and multiple linear regression, using the data on Moroccan donkeys.

## Exercise 1: Reload your R project and script ##

1. Start by reloading your R project file (remember it's stored in under your Documents folder).

2. It should start with the `donkey.R` script loaded from last time. If not, you should be able to select that script from the `Files` tab on the bottom right. In case you weren't here last week, you should first go through Exercise 1 of the Lab 1, and then download `donkey.R` from stream and place it in your folder.

## Exercise 2: Model diagnostics ##

1. Add the following code to produce diagnostic plots for the linear model we fitted last time.

    ```
    #' Diagnostic plots for the linear model.
    par(mfrow=c(2,2)) # creates a 2x2 plot
    plot(lm1)
    ```

2. Take a good look at the diagnostic plots. Recall what the 4 assumptions of the linear model are, and see whether each of them is satistifed or not. Discuss this with those around you.
3. A transformation is one way to deal with the non-linearity of the model. Instead of modelling the body weight in terms of the heart girth directly, we could instead take log-transforms of both body weight and heart girth to get rid of the curvature in the relationship.

    ```
    #' Let's try modelling the log of body weight versus log heartgirth to see if we
    #' get a better model.
    lm2 <- lm(log(Bodywt) ~ log(Heartgirth), data=donkey)
    summary(lm2)
    ```

4. Add the necessary code to include model diagnostics for this new model. How is the assumption of linearity now? What about the other assumptions?

5. Compare the summary output of the two models you have. Which do you think is better? Why?

6. In the last lab we produced confidence and prediction intervals for a donkey with heartgirth equal to 110cm. Re-do these using your model. Remember that you'll need to exponentiate the resulting intervals! (Why?)

7. How do these intervals compare with your previous ones? Add some comments to your R script about this.

## Exercise 3: Multiple regression ##

In this exercise, we'll extend our linear model to take into account some of the other variables in the data.

1. We'll start by adding in the umbilical girth to the first model (`lm1`). You can do that as follows.

    ```
    #' A linear model containing both heart and umbilical girths.
    lm3 <- lm(Bodywt ~ Heartgirth + Umbgirth, data=donkey)
    ```
2. Produce the model summary of this, and compare it to the model summary of `lm1`. You'll notice a few things.
    * The estimate for `Heartgirth` will have changed.
    * There is a new row for `Umbgirth`.

3. Why do you think the estimate (and thus P-values etc) for `Heartgirth` changed?  What is the P-value here testing?

4. What is your conclusion about the relationship between `Bodywt`, `Heartgirth` and `Umbgirth`?

5. Now add in both `Length` and `Height` to your linear model, and check the model summary. What is your conclusion about the relationship between `Bodywt` and `Height` ?

6. Do a linear model relating `Bodywt` to only `Height`. You should find that `Height` is highly significant. Why is it not significant in the larger model? *Hint: You might want to take a look at the pairs plot we did in lab 1*.

7. Make sure you add some more comments to your R script and re-compile it so you can refer to it later.
